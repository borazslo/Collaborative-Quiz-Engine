{%  extends 'html.twig' %}

{% block container %}
        
      <h1>
          {{ 'Questions that require manual attention'|t }}
          <small><small><small>
            {% for title,url in menu %}
                [<a href="{{ url }}">{{ title }}</a>] 
            {% endfor %}
          </small></small></small>
      </h1>
      {% for question in quiz.questions %}
          <h2>{{ question.id }}. kérdés: <small>{{ question.question|striptags  }}</small></h2>
          {% if question.answersToCheck is  empty  %}<div class="alert alert-info">{{ "There is nothing to check. But if you refresh the page, you could find new answers."|t }}</div>{% endif %}
          {{ question.forAdmin }}
          {% for answer in question.answersToCheck %}
          <div class="card" id="cardid{{ answer.id }}" data-id="{{ answer.id }}" >
            <div class="row no-gutters">
              <div class="col-md-8 col">
                  {% if question.type== 'photo' %}
                    <img src="{{ answer.answer}}" class="card-img" >
                  {% else %}
                      <p style="padding:20px">{{ answer.answer}}</p>
                  {% endif %}
              </div>
              <div class="col-md-4 col">
                <div class="card-body">
                  <h5 class="card-title">{{ answer.user }} ({{ answer.group }})</h5>
                  <p class="card-text"><small class="text-muted">{{ "Uploaded"|t }}: <span title="{{ answer.timestamp|date('Y-m-d H:i:s') }}">{{ answer.timestamp|timeago }}</span></small></p>
                  <button type="button" class="action btn btn-success" data-action="ok" data-id="{{ answer.id }}">{{ "Accept"|t }}</button>
                  <button type="button" class="action btn btn-danger" data-action="no" data-id="{{ answer.id }}">{{ "Deny"|t }}</button>
                </div>
              </div>
            </div>
          </div>
          {% endfor %}
          <hr>
      {% endfor %}
  
  {% endblock %}
  

{% block script %}
<script>
$(function() {
      
      $(document).on('click','.action',function(){
          
    var $this= $(this);

    var action = $(this).attr("data-action");
    var valaszid = $(this).attr("data-id");
    
    console.log("action: " + action + " id: " + valaszid);

    $.ajax({
       type:"POST",
       url:"index.php",
       data:"admin=verify&action="+action+"&id="+valaszid,
       success:function(response){
          console.log(response);
          $(response).hide();          
          
      }, 
    });
  
  });
  
  setInterval(function(){
     var list = $(".card").filter(":visible").map(function(){return $(this).attr("data-id");}).get();
     
        console.log("admin=verify&action=update&ids=" + list );
        
        $.ajax({
       type:"POST",
       url:"index.php",
       data:"admin=verify&action=update&ids=" + list ,
       success:function(response){
          console.log(response);
          $(response).hide();          
          
      }, 
    });
    
    
  
    }, 2000);

});
  </script>
   <script>$(document).ready(function () {
$('#ranglista').DataTable({
"searching": false, // false to disable search (or any other option)
"paging": false,
"order": [[ 3, "asc" ]]
});
$('.dataTables_length').addClass('bs-select');
});</script>
{%  endblock %}
